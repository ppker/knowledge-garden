/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var d=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var U=(n,o,e)=>o in n?d(n,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[o]=e;var D=(n,o)=>{for(var e in o)d(n,e,{get:o[e],enumerable:!0})},F=(n,o,e,t)=>{if(o&&typeof o=="object"||typeof o=="function")for(let i of k(o))!N.call(n,i)&&i!==e&&d(n,i,{get:()=>o[i],enumerable:!(t=E(o,i))||t.enumerable});return n};var S=n=>F(d({},"__esModule",{value:!0}),n);var g=(n,o,e)=>U(n,typeof o!="symbol"?o+"":o,e);var L={};D(L,{default:()=>w});module.exports=S(L);var c=require("obsidian");var u=require("obsidian"),C={loadImageBlob:5e3,successNotice:1800};function f(n){let o=["avif","bmp","gif","jpg","jpeg","png","svg","webp","heic"];return n=n.toLowerCase(),o.some(e=>n.endsWith(`.${e}`))}function b(n){return n=new URL(n),n.search="",n.toString()}function B(n,o){let e=new Promise((t,i)=>setTimeout(()=>{i(new Error(`timed out after ${n} ms`))},n));return Promise.race([o,e])}async function A(n){let o=n instanceof ArrayBuffer?new Blob([n],{type:"image/png"}):await P(n);try{let e=new ClipboardItem({[o.type]:o});await navigator.clipboard.write([e]),new u.Notice(i18next.t("interface.copied_generic"),C.successNotice)}catch(e){console.error(e),new u.Notice(i18next.t("interface.copy_failed"))}}function P(n){let o=()=>new Promise((e,t)=>{let i=new Image;i.crossOrigin="anonymous",i.onload=()=>{let a=document.createElement("canvas");a.width=i.width,a.height=i.height,a.getContext("2d").drawImage(i,0,0),a.toBlob(p=>{e(p)})},i.onerror=async()=>{try{await fetch(i.src,{mode:"no-cors"});let a=await P(`https://api.allorigins.win/raw?url=${encodeURIComponent(n)}`);e(a)}catch(a){t(new Error)}},i.src=n});return B(C.loadImageBlob,o())}function I(n,o,e,t,i){return n.on(o,e,t,i),()=>{n.off(o,e,t,i)}}function y(n,o){let e=(0,u.normalizePath)(n.vault.adapter.basePath);e=e.replace("file://","");let t=o.pathname;if(t=t.replace("/_capacitor_file_",""),t=t.split("/").filter(i=>i!=="").join("/"),t.startsWith(e)){let i=t.slice(e.length+1),a=decodeURI(i);return n.vault.getFileByPath(a)}return null}function h(n,o){n.workspace.getLeaf(!0).openFile(o,{active:!0})}function l(n,o,e){let t={"copy-to-clipboard":{section:"info",icon:"image-file",title:"interface.label-copy"},"open-in-new-tab":{section:"open",icon:"file-plus",title:"interface.menu.open-in-new-tab"},"open-in-default-app":{section:"system",icon:"arrow-up-right",title:"plugins.open-with-default-app.action-open-file"},"show-in-explorer":{section:"system",icon:"arrow-up-right",title:`plugins.open-with-default-app.action-show-in-folder${u.Platform.isMacOS?"-mac":""}`},"reveal-in-navigation":{section:"system",icon:"folder",title:"plugins.file-explorer.action-reveal-file"},"reveal-in-navigation-tree":{section:"system",icon:"folder",title:"Reveal in File Tree Alternative"},"rename-file":{section:"info",icon:"pencil",title:"interface.menu.rename"}};return o==="copy-to-clipboard"&&e&&n.onClick(async()=>{await A(typeof e=="string"?e:await e)}),n.setIcon(t[o].icon).setTitle(i18next.t(t[o].title)).setSection(t[o].section)}var m=require("obsidian");var M={middleClickNewTab:!0,revealInNavigation:!0,enableDefaultOnCanvas:!1},v=class extends m.PluginSettingTab{constructor(e,t){super(e,t);g(this,"plugin");this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h3",{text:"Image Context Menus settings"}),new m.Setting(e).setName("Middle mouse click on image link to open in new tab").addToggle(t=>{t.setValue(this.plugin.settings.middleClickNewTab).onChange(i=>{this.plugin.settings.middleClickNewTab=i,this.plugin.saveSettings()})}),new m.Setting(e).setName("Reveal file in navigation menu item").setDesc("You might want to disable this if you use a plugin for replacing default Obsidian file navigation. This plugin supports File Tree Alternative by displaying a reveal menu item for it if installed.").addToggle(t=>{t.setValue(this.plugin.settings.revealInNavigation).onChange(i=>{this.plugin.settings.revealInNavigation=i,this.plugin.saveSettings()})}),new m.Setting(e).setName("Enable regular context menu on canvas").setDesc(`The regular context menu sometimes duplicates the context menu on the canvas, so it's disabled there by default.
There is a separate context menu for images directly on the canvas, but if that's not enough (for example for images in notes on canvas), you can enable the regular context menu here too.`).addToggle(t=>{t.setValue(this.plugin.settings.enableDefaultOnCanvas).onChange(i=>{this.plugin.settings.enableDefaultOnCanvas=i,this.plugin.saveSettings()})})}};var w=class extends c.Plugin{constructor(){super(...arguments);g(this,"canvasCardMenu");g(this,"settings")}async loadSettings(){this.settings=Object.assign({},M,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async onload(){await this.loadSettings(),this.addSettingTab(new v(this.app,this)),this.registerDocument(document),this.app.workspace.on("window-open",(e,t)=>{this.registerDocument(t.document)}),this.registerEvent(this.app.workspace.on("file-menu",(e,t,i)=>{i==="canvas-menu"&&t instanceof c.TFile&&f(`.${t.extension}`)&&(e.addItem(a=>l(a,"open-in-new-tab").onClick(()=>{h(this.app,t)})),e.addItem(a=>l(a,"copy-to-clipboard",this.app.vault.readBinary(t))))})),this.registerEvent(this.app.workspace.on("canvas:node-menu",(e,t)=>{let i=t.unknownData;if(i.type==="link"){let a=b(i.url);if(!f(a))return;e.addItem(r=>l(r,"copy-to-clipboard",a).setSection("canvas"))}})),this.registerEvent(this.app.workspace.on("url-menu",(e,t)=>{t=b(t),f(t)&&e.addItem(i=>l(i,"copy-to-clipboard",t))}))}registerDocument(e){let t=[I(e,"contextmenu","img",this.onImageContextMenu.bind(this),{capture:!0}),I(e,"mouseup","img",this.onImageMouseUp.bind(this))];this.register(()=>{for(let i of t)i()})}onImageContextMenu(e){var T;if(!this.settings.enableDefaultOnCanvas&&((T=this.app.workspace.getActiveFile())==null?void 0:T.extension)==="canvas")return;e.preventDefault();let t=e.target,i=new URL(t.src);if(!["app:","data:","http:","https:"].includes(i.protocol)){new c.Notice(`No handler for ${i.protocol} protocol`);return}let r=new c.Menu,p=y(this.app,i);r.addSections(["file","open","info","system"]),p&&r.addItem(s=>l(s,"rename-file").onClick(()=>this.app.fileManager.promptForFileRename(p))),r.addItem(s=>l(s,"copy-to-clipboard",t.src)),p&&(c.Platform.isMobile&&r.addItem(s=>s.setTitle(p.name).setSection("file").setIsLabel(!0)),r.addItem(s=>l(s,"open-in-new-tab").onClick(()=>{h(this.app,p)})),c.Platform.isDesktop&&(r.addItem(s=>l(s,"open-in-default-app").onClick(()=>{this.app.openWithDefaultApp(p.path)})),r.addItem(s=>l(s,"show-in-explorer").onClick(()=>{this.app.showInFolder(p.path)}))),this.settings.revealInNavigation&&r.addItem(s=>l(s,"reveal-in-navigation").onClick(()=>{var x;(x=this.app.internalPlugins.getEnabledPluginById("file-explorer"))==null||x.revealInFolder(p)})),this.app.plugins.enabledPlugins.has("file-tree-alternative")&&r.addItem(s=>l(s,"reveal-in-navigation-tree").onClick(()=>{self.dispatchEvent(new CustomEvent("fta-reveal-file",{detail:{file:p}}))}))),r.showAtPosition({x:e.pageX,y:e.pageY})}onImageMouseUp(e){let t=e.target;if(e.button===1&&this.settings.middleClickNewTab){let a=y(this.app,new URL(t.src));if(!a)return;h(this.app,a)}}};

/* nosourcemap */