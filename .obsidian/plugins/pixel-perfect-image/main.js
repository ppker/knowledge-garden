/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var H=Object.defineProperty;var ye=Object.getOwnPropertyDescriptor;var ve=Object.getOwnPropertyNames;var Fe=Object.prototype.hasOwnProperty;var Ce=(i,e)=>{for(var t in e)H(i,t,{get:e[t],enumerable:!0})},Me=(i,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of ve(e))!Fe.call(i,n)&&n!==t&&H(i,n,{get:()=>e[n],enumerable:!(a=ye(e,n))||a.enumerable});return i};var Se=i=>Me(H({},"__esModule",{value:!0}),i);var ke={};Ce(ke,{default:()=>O});module.exports=Se(ke);var Pe=require("obsidian");var c=require("obsidian"),R={toggleIndividualMenuOptions:!1,showFileInfo:!0,showShowInFileExplorer:!0,showRenameOption:!0,showDeleteImageOption:!0,showOpenInNewTab:!0,showOpenInDefaultApp:!0,customResizeSizes:["25%","50%","100%"],cmdCtrlClickBehavior:"do-nothing",enableWheelZoom:!0,wheelModifierKey:"Alt",wheelZoomPercentage:20,invertScrollDirection:!1,externalEditorName:"",externalEditorPathMac:"",externalEditorPathWin:"",confirmBeforeDelete:!0,debugMode:!1};function T(i){return c.Platform.isMacOS?i.externalEditorPathMac:i.externalEditorPathWin}var S=class extends c.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}setElementVisibility(e,t){e.style.display=t?"block":"none"}async display(){let{containerEl:e}=this;e.empty();let t;new c.Setting(e).setName("Toggle individual menu options").setDesc("Show settings to toggle individual menu items").addToggle(n=>n.setValue(this.plugin.settings.toggleIndividualMenuOptions).onChange(async s=>{this.plugin.settings.toggleIndividualMenuOptions=s,await this.plugin.saveSettings(),this.setElementVisibility(t,s)})),t=e.createDiv("pixel-perfect-sub-settings"),new c.Setting(t).setName("File information").setDesc("Show filename and dimensions at top of menu").addToggle(n=>{n.setValue(this.plugin.settings.showFileInfo).onChange(async s=>{this.plugin.settings.showFileInfo=s,await this.plugin.saveSettings()})}),new c.Setting(t).setName("Show in Finder/Explorer").setDesc("Show option to reveal image in system file explorer").addToggle(n=>n.setValue(this.plugin.settings.showShowInFileExplorer).onChange(async s=>{this.plugin.settings.showShowInFileExplorer=s,await this.plugin.saveSettings()})),new c.Setting(t).setName("Rename image").setDesc("Show option to rename image file").addToggle(n=>n.setValue(this.plugin.settings.showRenameOption).onChange(async s=>{this.plugin.settings.showRenameOption=s,await this.plugin.saveSettings()})),new c.Setting(t).setName("Delete image and link").setDesc("Show option to delete both image file and link").addToggle(n=>n.setValue(this.plugin.settings.showDeleteImageOption).onChange(async s=>{this.plugin.settings.showDeleteImageOption=s,await this.plugin.saveSettings()})),new c.Setting(t).setName("Open in new tab").setDesc("Show option to open image in new tab").addToggle(n=>n.setValue(this.plugin.settings.showOpenInNewTab).onChange(async s=>{this.plugin.settings.showOpenInNewTab=s,await this.plugin.saveSettings()})),new c.Setting(t).setName("Open in default app").setDesc("Show option to open image in default app").addToggle(n=>n.setValue(this.plugin.settings.showOpenInDefaultApp).onChange(async s=>{this.plugin.settings.showOpenInDefaultApp=s,await this.plugin.saveSettings()})),new c.Setting(e).setName("Resize options").setDesc("Set resize options (comma-separated). Use % for percentages (e.g., 25%, 50%) or px for pixels (e.g., 600px, 800px)").addText(n=>{n.setPlaceholder("e.g., 25%, 50%, 100%, 600px").setValue(this.plugin.settings.customResizeSizes.join(", ")).onChange(async s=>{let o=s.split(",").map(r=>r.trim()).filter(r=>{let l=r.match(/^(\d+)(px|%)$/);return l&&parseInt(l[1])>0});this.plugin.settings.customResizeSizes=o,await this.plugin.saveSettings()})});let a=c.Platform.isMacOS?"CMD":"CTRL";new c.Setting(e).setName(`${a} + click behavior`).setDesc(`Choose what happens when you ${a} + click an image`).addDropdown(n=>{let s=this.plugin.settings.externalEditorName.trim()||"external editor";n.addOption("do-nothing","Do nothing").addOption("open-in-new-tab","Open in new tab").addOption("open-in-default-app","Open in default app").addOption("open-in-external-editor",`Open in ${s}`).setValue(this.plugin.settings.cmdCtrlClickBehavior).onChange(async o=>{this.plugin.settings.cmdCtrlClickBehavior=o,await this.plugin.saveSettings()})}),new c.Setting(e).setName("Mousewheel zoom").setHeading(),new c.Setting(e).setName("Enable mousewheel zoom").setDesc("Hold modifier key and scroll to resize images").addToggle(n=>{n.setValue(this.plugin.settings.enableWheelZoom).onChange(async s=>{this.plugin.settings.enableWheelZoom=s,await this.plugin.saveSettings()})}),new c.Setting(e).setName("Modifier key").setDesc("Key to hold while scrolling to zoom images").addDropdown(n=>{let s=c.Platform.isMacOS;n.addOption("Alt",s?"Option":"Alt").addOption("Ctrl","Ctrl").addOption("Shift","Shift").setValue(this.plugin.settings.wheelModifierKey).onChange(async o=>{this.plugin.settings.wheelModifierKey=o,await this.plugin.saveSettings()})}),new c.Setting(e).setName("Zoom step size").setDesc("Percentage to zoom per scroll step").addExtraButton(n=>{n.setIcon("reset").setTooltip("Reset to default").onClick(async()=>{this.plugin.settings.wheelZoomPercentage=R.wheelZoomPercentage,await this.plugin.saveSettings(),this.display()})}).addSlider(n=>{var r;let s=createSpan();s.addClass("pixel-perfect-zoom-value");let o=l=>{s.setText(`${l}%`)};n.setDynamicTooltip().setLimits(1,100,1).setValue(this.plugin.settings.wheelZoomPercentage).onChange(async l=>{o(l),this.plugin.settings.wheelZoomPercentage=l,await this.plugin.saveSettings()}),o(this.plugin.settings.wheelZoomPercentage),(r=n.sliderEl.parentElement)==null||r.prepend(s)}),new c.Setting(e).setName("Invert scroll direction").setDesc("Invert the zoom direction when scrolling").addToggle(n=>{n.setValue(this.plugin.settings.invertScrollDirection).onChange(async s=>{this.plugin.settings.invertScrollDirection=s,await this.plugin.saveSettings()})}),new c.Setting(e).setName("External editor").setHeading(),new c.Setting(e).setName("External editor name").setDesc("Name of your external editor (e.g., Photoshop)").addText(n=>{n.setPlaceholder("Photoshop").setValue(this.plugin.settings.externalEditorName).onChange(async s=>{this.plugin.settings.externalEditorName=s,await this.plugin.saveSettings()})}),c.Platform.isMacOS&&new c.Setting(e).setName("External editor path (macOS)").setDesc("Full path to your external editor application on macOS").addText(n=>{n.setPlaceholder("/Applications/Adobe Photoshop 2025/Adobe Photoshop 2025.app").setValue(this.plugin.settings.externalEditorPathMac).onChange(async s=>{let o=s.replace(/\\ /g," ");this.plugin.settings.externalEditorPathMac=o,await this.plugin.saveSettings()})}),c.Platform.isWin&&new c.Setting(e).setName("External editor path (Windows)").setDesc("Full path to your external editor application on Windows").addText(n=>{n.setPlaceholder("C:\\Program Files\\Adobe\\Adobe Photoshop 2025\\Photoshop.exe").setValue(this.plugin.settings.externalEditorPathWin).onChange(async s=>{let o=s.replace(/\\ /g," ");this.plugin.settings.externalEditorPathWin=o,await this.plugin.saveSettings()})}),new c.Setting(e).setName("Advanced").setHeading(),new c.Setting(e).setName("Confirm before delete").setDesc("Show confirmation dialog before deleting files").addToggle(n=>n.setValue(this.plugin.settings.confirmBeforeDelete).onChange(async s=>{this.plugin.settings.confirmBeforeDelete=s,await this.plugin.saveSettings()})),new c.Setting(e).setName("Debug mode").setDesc("Enable debug logging to console").addToggle(n=>{n.setValue(this.plugin.settings.debugMode).onChange(async s=>{this.plugin.settings.debugMode=s,await this.plugin.saveSettings()})}),this.setElementVisibility(t,this.plugin.settings.toggleIndividualMenuOptions)}};var y=require("obsidian");function w(i){return!i||!(i instanceof HTMLElement)?null:i instanceof HTMLImageElement?i:i.matches('.image-container, .image-embed, img, a.internal-embed[src*=".png"], a.internal-embed[src*=".jpg"], a.internal-embed[src*=".jpeg"], a.internal-embed[src*=".gif"], a.internal-embed[src*=".webp"], a.internal-embed[src*=".svg"]')?i.querySelector("img"):null}function m(...i){let e=new Date().toTimeString().split(" ")[0];console.error(`${e}`,...i)}function b(i){this.isModifierKeyHeld=i}function X(i){this.wheelEventCleanup&&(this.wheelEventCleanup(),this.wheelEventCleanup=null);let e=i.document,t=r=>{k.call(this,r)&&b.call(this,!0)},a=r=>{k.call(this,r)&&b.call(this,!1)},n=()=>{this.isModifierKeyHeld&&b.call(this,!1)},s=async r=>{if(!this.settings.enableWheelZoom||!this.isModifierKeyHeld)return;if(!K.call(this,r)){b.call(this,!1);return}let l=w(r.target);if(l){r.preventDefault();try{await $.call(this,r,l)}catch(h){m("Error handling wheel event:",h),new y.Notice("Failed to resize image")}}};this.registerDomEvent(e,"keydown",t),this.registerDomEvent(e,"keyup",a),this.registerDomEvent(window,"blur",n);let o=new AbortController;e.addEventListener("wheel",s,{passive:!1,signal:o.signal}),this.register(()=>o.abort()),this.wheelEventCleanup=()=>{o.abort()}}function k(i){let e=this.settings.wheelModifierKey.toLowerCase(),t=i.key.toLowerCase();switch(e){case"alt":return t==="alt"||t==="option";case"ctrl":return t==="ctrl"||t==="control";case"shift":return t==="shift";default:return!1}}function K(i){switch(this.settings.wheelModifierKey.toLowerCase()){case"alt":return i.altKey;case"ctrl":return i.ctrlKey;case"shift":return i.shiftKey;default:return!1}}async function $(i,e){if(!this.settings.enableWheelZoom)return;let t=this.app.workspace.getActiveViewOfType(y.MarkdownView);if(!(t!=null&&t.file))return;let a=await this.getImageFileWithErrorHandling(e);if(!a)return;let{width:n}=await this.readImageDimensions(a.imgFile),s=this.getCurrentImageWidth(e,a.activeFile,a.imgFile),o=s!=null?s:n,r=Math.min(1,Math.abs(i.deltaY)/10),l=Math.max(1,Math.round(o*(this.settings.wheelZoomPercentage/100)*r)),h=i.deltaY<0,f=(this.settings.invertScrollDirection?!h:h)?o+l:Math.max(1,o-l);f!==o&&await this.updateImageLinkWidth(a.imgFile,f)}function Y(i){if(!(i.metaKey||i.ctrlKey))return;let e=w(i.target);e&&this.settings.cmdCtrlClickBehavior!=="do-nothing"&&(i.preventDefault(),this.getImageFileWithErrorHandling(e).then(t=>{t&&(this.settings.cmdCtrlClickBehavior==="open-in-new-tab"?this.app.workspace.openLinkText(t.imgFile.path,"",!0):this.settings.cmdCtrlClickBehavior==="open-in-default-app"?this.openInDefaultApp(t.imgFile):this.settings.cmdCtrlClickBehavior==="open-in-external-editor"&&this.openInExternalEditor(t.imgFile.path))}).catch(t=>{let a="perform action";this.settings.cmdCtrlClickBehavior==="open-in-new-tab"?a="open image in new tab":this.settings.cmdCtrlClickBehavior==="open-in-default-app"?a="open image in default app":this.settings.cmdCtrlClickBehavior==="open-in-external-editor"&&(a=`open image in ${this.settings.externalEditorName.trim()||"external editor"}`),m(`Failed to ${a}:`,t),new y.Notice(`Failed to ${a}`)}))}var u=require("obsidian");var Q=require("path"),ee=require("obsidian");function J(){this.registerDomEvent(document,"contextmenu",D.bind(this));let i,e=!1;this.registerDomEvent(document,"touchstart",t=>{t.touches.length>1||!w(t.target)||(e=!1,i=setTimeout(()=>{e=!0,D.call(this,t)},500))}),this.registerDomEvent(document,"touchend",()=>{clearTimeout(i)}),this.registerDomEvent(document,"touchmove",()=>{clearTimeout(i)})}async function D(i){if("touches"in i&&i.touches.length>1)return;let e=w(i.target);if(!e)return;i.preventDefault();let t=new u.Menu;await z.call(this,t,e),await B.call(this,t,i),u.Platform.isMobile||(t.addSeparator(),_.call(this,t,e));let a={x:i instanceof MouseEvent?i.pageX:i.touches[0].pageX,y:i instanceof MouseEvent?i.pageY:i.touches[0].pageY};t.showAtPosition(a)}function q(i,e,t){i.addItem(a=>{a.setTitle(e).setIcon(t).setDisabled(!0)})}async function z(i,e){if(this.settings.showFileInfo)try{let t=await this.getImageFileWithErrorHandling(e);if(!t)return;let{width:a,height:n}=await this.readImageDimensions(t.imgFile),s=this.calculateImageScale(e,t.activeFile,t.imgFile,a),o=s!==null?` @ ${s}%`:"";q(i,`${t.imgFile.name}${o}`,"image-file"),q(i,`${a} \xD7 ${n} px`,"info")}catch(t){m("Could not read dimensions:",t),new u.Notice("Could not read image dimensions")}}function V(i,e){return async()=>{try{await i()}catch(t){m(e,t);let a=t instanceof Error?t.message:e;new u.Notice(a)}}}function p(i,e,t,a,n,s=!1){i.addItem(o=>{o.setTitle(e).setIcon(t).setDisabled(s).onClick(V.call(this,a,n))})}async function B(i,e){let t=w(e.target);if(!t)return;p.call(this,i,"Copy image","copy",async()=>{await this.copyImageToClipboard(t),new u.Notice("Image copied to clipboard")},"Failed to copy image to clipboard"),p.call(this,i,"Copy local path","link",async()=>{let o=await this.getImageFileWithErrorHandling(t);if(!o)return;let r=this.app.vault.adapter.basePath,l=(0,Q.join)(r,(0,ee.normalizePath)(o.imgFile.path));await navigator.clipboard.writeText(l),new u.Notice("File path copied to clipboard")},"Failed to copy file path"),i.addSeparator();let a=await this.getImageFileWithErrorHandling(t),n=null,s=null;if(a){let{width:o}=await this.readImageDimensions(a.imgFile);s=this.getCurrentImageWidth(t,a.activeFile,a.imgFile),n=s!==null?Math.round(s/o*100):null}this.settings.customResizeSizes.length>0&&this.settings.customResizeSizes.forEach(o=>{let r=o.match(/^(\d+)(px|%)$/);if(!r)return;let l=parseInt(r[1]),h=r[2],d=`Resize to ${o}`,f=h==="%",C=f?n===l:s===l;p.call(this,i,d,"image",async()=>await this.resizeImage(t,l,!f),`Failed to resize image to ${o}`,C)}),a&&n!==null&&p.call(this,i,"Remove custom size","reset",async()=>{await this.removeImageWidth(a.imgFile),new u.Notice("Removed custom size from image")},"Failed to remove custom size from image")}function _(i,e){if(u.Platform.isMobile)return;let t=u.Platform.isMacOS;this.settings.showShowInFileExplorer&&p.call(this,i,t?"Show in Finder":"Show in Explorer","folder-open",async()=>{let n=await this.getImageFileWithErrorHandling(e);n&&await this.showInSystemExplorer(n.imgFile)},"Failed to open system explorer"),this.settings.showRenameOption&&p.call(this,i,"Rename image","pencil",async()=>{let n=await this.getImageFileWithErrorHandling(e);n&&await this.renameImage(n.imgFile)},"Failed to rename image"),this.settings.showDeleteImageOption&&p.call(this,i,"Delete image and link","trash",async()=>{let n=await this.getImageFileWithErrorHandling(e);n&&await this.deleteImageAndLink(n.imgFile)},"Failed to delete image"),(this.settings.showRenameOption||this.settings.showDeleteImageOption||this.settings.showShowInFileExplorer)&&i.addSeparator(),this.settings.showOpenInNewTab&&p.call(this,i,"Open in new tab","link-2",async()=>{let n=await this.getImageFileWithErrorHandling(e);n&&await this.app.workspace.openLinkText(n.imgFile.path,"",!0)},"Failed to open image in new tab"),this.settings.showOpenInDefaultApp&&p.call(this,i,"Open in default app","image",async()=>{let n=await this.getImageFileWithErrorHandling(e);n&&await this.openInDefaultApp(n.imgFile)},"Failed to open in default app");let a=T(this.settings);if(a!=null&&a.trim()){let n=this.settings.externalEditorName.trim()||"external editor";p.call(this,i,`Open in ${n}`,"edit",async()=>{let s=await this.getImageFileWithErrorHandling(e);s&&await this.openInExternalEditor(s.imgFile.path)},`Failed to open image in ${n}`)}}var te=require("obsidian");var v=/(!\[\[)([^\]]+)(\]\])/g,F=/!\[([^\]]*)\]\(([^)]+)\)/g;async function ie(i,e,t=!1){let a=await this.getImageFileWithErrorHandling(i);if(!a)throw new Error("Could not find the image file");let{width:n}=await this.readImageDimensions(a.imgFile),s=t?e:Math.round(n*e/100);await this.updateImageLinkWidth(a.imgFile,s)}async function ne(i,e){let t=await this.updateImageLinks(i,a=>{let n=a.length>0?a[a.length-1]:null;return n!==null&&!isNaN(parseInt(n))?[...a.slice(0,a.length-1),String(e)]:[...a,String(e)]})}async function ae(i){let e=await this.updateImageLinks(i,t=>{let a=t.length>0?t[t.length-1]:null;return a!==null&&!isNaN(parseInt(a))?t.slice(0,t.length-1):t})}async function se(i){if(this.dimensionCache.has(i.path))return this.dimensionCache.get(i.path);try{let e=await this.app.vault.readBinary(i),t=Te(e,"image/*"),a=URL.createObjectURL(t);try{let n=await le(a),s={width:n.width,height:n.height};return this.dimensionCache.set(i.path,s),s}finally{URL.revokeObjectURL(a)}}catch(e){throw m("Failed to read image file:",e),e}}function oe(i,e,t,a){let n=this.getCurrentImageWidth(i,e,t);return n===null?null:Math.round(n/a*100)}function re(i,e,t){var r;let a=(r=this.app.workspace.getActiveViewOfType(te.MarkdownView))==null?void 0:r.editor;if(!a)return null;let n=a.getValue(),s=null,o=l=>{if(l.length===0)return null;let h=l[l.length-1],d=parseInt(h);return isNaN(d)?null:d};for(let l of n.matchAll(v)){let[h,d,f]=l,[C]=f.split("#",1),[A,...M]=C.split("|"),I=this.app.metadataCache.getFirstLinkpathDest(A,e.path);if((I==null?void 0:I.path)===t.path){let x=o(M);if(x!==null){s=x;break}}}if(s===null)for(let l of n.matchAll(F)){let[h,d,f]=l,[C,...A]=d.split("|"),M=f;try{M=decodeURIComponent(f)}catch(x){}let I=this.app.metadataCache.getFirstLinkpathDest(M,e.path);if((I==null?void 0:I.path)===t.path){let x=o(A);if(x!==null){s=x;break}}}return s}function le(i,e){return new Promise((t,a)=>{let n=new Image;e&&(n.crossOrigin=e),n.onload=()=>t(n),n.onerror=()=>a(new Error("Failed to load image")),n.src=i})}function Te(i,e){return new Blob([new Uint8Array(i)],{type:e})}async function ce(i){try{let e=await le(i.src,"anonymous"),t=document.createElement("canvas");t.width=e.naturalWidth,t.height=e.naturalHeight;let a=t.getContext("2d");if(!a)throw new Error("Failed to get canvas context");a.drawImage(e,0,0);let n=await new Promise(o=>{t.toBlob(o)});if(!n)throw new Error("Failed to create blob");let s=new ClipboardItem({[n.type]:n});await navigator.clipboard.write([s])}catch(e){throw m("Copy to clipboard failed:",e),e instanceof Error&&e.message.includes("Document is not focused")?new Error("Please click in the editor first, then try copying again"):e}}var he=require("obsidian");function Z(i,e,t,a){return i=i.replace(v,(n,s,o,r)=>{let l=E.call(this,o);if(!P.call(this,l.path,e,t))return n;l.params=a(l.params);let h=L.call(this,l);return`${s}${h}${r}`}),i.replace(F,(n,s,o)=>{let r=E.call(this,s,o);if(!P.call(this,r.path,e,t))return n;let l=s.split("|")[0].trim()||t.basename;return r.params=a(r.params),`![${r.params.length>0?[l,...r.params].join("|"):l}](${L.call(this,{...r,params:[]},!0)})`})}function E(i,e){let t=e!=null?e:i;if(e)try{t=decodeURIComponent(t)}catch(h){}let[a,n]=t.split("#",2),s=n?`#${n}`:"",[o,...r]=(e?i:a).split("|");return{path:e?a:o,hash:s,params:r,isWikiStyle:!e}}function L(i,e=!1){let t=i.params.length>0?`|${i.params.join("|")}`:"",a=i.path;return e&&(a=i.path.split("/").map(n=>encodeURIComponent(n)).join("/")),`${a}${t}${i.hash}`}async function me(i,e){let t=this.app.workspace.getActiveFile();if(!t)throw new Error("No active file, cannot update link.");if(t.path===i.path)return!1;if(!this.app.workspace.getActiveViewOfType(he.MarkdownView))throw new Error("No active MarkdownView to update.");let n=await this.app.vault.read(t),s=n,o=-1;n.startsWith(`---
`)&&(o=n.indexOf(`
---
`,4),o!==-1&&(o+=5,s=n.substring(o)));let r=Z.call(this,s,t,i,e);if(r!==s)try{return await this.app.vault.process(t,l=>o!==-1?l.substring(0,o)+r:r),!0}catch(l){throw m("Failed to update file content:",l),new Error("Failed to update image link")}return!1}function P(i,e,t){let a=this.app.metadataCache.getFirstLinkpathDest(i,e.path);return!a||t&&a.path!==t.path?null:a}async function ge(i){let e=this.app.workspace.getActiveFile();if(!e)throw new Error("No active file, cannot remove links.");if(e.path===i.path)return!1;let t=await this.app.vault.read(e),a=t,n=-1;t.startsWith(`---
`)&&(n=t.indexOf(`
---
`,4),n!==-1&&(n+=5,a=t.substring(n)));let s=a;if(s=s.replace(v,(o,r,l,h)=>{let d=E.call(this,l);return P.call(this,d.path,e,i)?"":o}),s=s.replace(F,(o,r,l)=>{let h=E.call(this,r,l);return P.call(this,h.path,e,i)?"":o}),s!==a)try{return await this.app.vault.process(e,o=>n!==-1?o.substring(0,n)+s:s),!0}catch(o){throw m("Failed to remove image links:",o),new Error("Failed to remove image links")}return!1}var g=require("obsidian"),de=require("path"),pe=require("child_process");var G=require("obsidian"),N=class extends G.Modal{constructor(t,a,n){super(t);this.result=null;this.originalName=a,this.onSubmit=n}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("pixel-perfect-rename-modal"),t.createEl("h2",{text:"Rename image",cls:"modal-title"});let a=t.createEl("form");a.addClass("pixel-perfect-rename-form");let n=a.createEl("input",{type:"text",value:this.originalName,cls:"pixel-perfect-rename-input"}),s=this.originalName.lastIndexOf(".");if(s>0){let h=this.originalName.substring(0,s);n.setSelectionRange(0,h.length)}let o=a.createDiv();o.addClass("pixel-perfect-button-container");let r=o.createEl("button",{text:"Rename",type:"submit",cls:"mod-cta"});o.createEl("button",{text:"Cancel",type:"button"}).addEventListener("click",()=>{this.onSubmit(null),this.close()}),a.addEventListener("submit",h=>{h.preventDefault();let d=n.value.trim();d&&d!==this.originalName?this.onSubmit(d):this.onSubmit(null),this.close()}),n.focus()}onClose(){let{contentEl:t}=this;t.empty(),this.result===void 0&&this.onSubmit(null)}},W=class extends G.Modal{constructor(e,t,a){super(e),this.file=t,this.onConfirm=a}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("pixel-perfect-delete-modal"),e.createEl("h2",{text:"Delete image",cls:"modal-title"});let t=e.createDiv();t.addClass("pixel-perfect-delete-message"),t.createEl("p",{text:`Are you sure you want to delete "${this.file.name}"?`}),t.createEl("p",{text:"This will delete both the image file and all links to it in the current document.",cls:"mod-warning"});let a=e.createDiv();a.addClass("pixel-perfect-button-container");let n=a.createEl("button",{text:"Delete",cls:"mod-warning"}),s=a.createEl("button",{text:"Cancel"});n.addEventListener("click",()=>{this.onConfirm(),this.close()}),s.addEventListener("click",()=>{this.close()}),s.focus()}onClose(){let{contentEl:e}=this;e.empty()}};function ue(i,e){var s;let t=(s=i.getAttribute("src"))!=null?s:"",a=i.getAttribute("alt"),n=U.call(this,t);if(n){let o=this.resolveLink(n,e);if(o)return o}if(a){a=a.split("|")[0].trim();let o=this.resolveLink(a,e);if(o)return o}return null}function U(i){try{let e=decodeURIComponent(i),[t]=e.split("?"),a=t.lastIndexOf("/");return a<0||a>=t.length-1?null:t.substring(a+1)}catch(e){return null}}async function fe(i){let e=this.app.workspace.getActiveFile();if(!e)return null;let t=this.getFileForImage(i,e);return t?{activeFile:e,imgFile:t}:((i.naturalWidth>0||i.src)&&new g.Notice("Could not locate image file"),null)}async function we(i){this.app.showInFolder(i.path)}async function Ie(i){this.app.openWithDefaultApp(i.path)}function xe(i){let e=T(this.settings),t=this.settings.externalEditorName.trim()||"External Editor";if(!e){new g.Notice(`Please set your ${t} path in Pixel Perfect Image settings.`);return}let a=this.app.vault.adapter;if(!(a instanceof g.FileSystemAdapter)){new g.Notice("Cannot open file: Vault is not a FileSystemAdapter");return}let n=a.getBasePath(),s=(0,de.join)(n,(0,g.normalizePath)(i)),o;g.Platform.isMacOS?o=`open -a "${e}" "${s}"`:o=`"${e}" "${s}"`,(0,pe.exec)(o,r=>{r&&(m(`Error launching ${t}:`,r),new g.Notice(`Could not open file in ${t}.`))})}async function be(i){var t;let e=await j.call(this,i);if(e)try{let n=`${((t=i.parent)==null?void 0:t.path)||"/"}/${e}`;await this.app.fileManager.renameFile(i,n),new g.Notice("Image renamed successfully")}catch(a){m("Failed to rename file:",a),new g.Notice("Failed to rename image")}}async function j(i){return new Promise(e=>{new N(this.app,i.name,a=>{e(a)}).open()})}async function Ee(i){let e=async()=>{try{let t=await this.removeImageLinks(i);await this.app.fileManager.trashFile(i),t?new g.Notice("Image and links deleted successfully"):new g.Notice("Image deleted successfully")}catch(t){m("Failed to delete image:",t),new g.Notice("Failed to delete image and links")}};this.settings.confirmBeforeDelete?new W(this.app,i,e).open():await e()}var O=class extends Pe.Plugin{constructor(){super(...arguments);this.dimensionCache=new Map;this.isModifierKeyHeld=!1;this.wheelEventCleanup=null;this.setModifierKeyState=b.bind(this);this.registerWheelEvents=X.bind(this);this.isModifierKeyMatch=k.bind(this);this.isModifierKeyStillHeld=K.bind(this);this.handleImageWheel=$.bind(this);this.handleImageClick=Y.bind(this);this.registerImageContextMenu=J.bind(this);this.handleContextMenu=D.bind(this);this.addDimensionsMenuItem=z.bind(this);this.addResizeMenuItems=B.bind(this);this.addFileOperationMenuItems=_.bind(this);this.addMenuItem=p.bind(this);this.createMenuClickHandler=V.bind(this);this.resizeImage=ie.bind(this);this.updateImageLinkWidth=ne.bind(this);this.removeImageWidth=ae.bind(this);this.readImageDimensions=se.bind(this);this.calculateImageScale=oe.bind(this);this.getCurrentImageWidth=re.bind(this);this.copyImageToClipboard=ce.bind(this);this.updateLinks=Z.bind(this);this.parseLinkComponents=E.bind(this);this.buildLinkPath=L.bind(this);this.updateImageLinks=me.bind(this);this.resolveLink=P.bind(this);this.removeImageLinks=ge.bind(this);this.getFileForImage=ue.bind(this);this.parseFileNameFromSrc=U.bind(this);this.getImageFileWithErrorHandling=fe.bind(this);this.showInSystemExplorer=we.bind(this);this.openInDefaultApp=Ie.bind(this);this.openInExternalEditor=xe.bind(this);this.renameImage=be.bind(this);this.promptForNewName=j.bind(this);this.deleteImageAndLink=Ee.bind(this);this.findImageElement=w.bind(this);this.errorLog=m.bind(this)}async onload(){await this.loadSettings(),this.addSettingTab(new S(this.app,this)),this.registerImageContextMenu(),this.registerDomEvent(document,"click",this.handleImageClick),this.registerEvent(this.app.workspace.on("layout-change",()=>this.registerWheelEvents(window))),this.registerWheelEvents(window)}onunload(){this.isModifierKeyHeld=!1,this.dimensionCache.clear()}async loadSettings(){this.settings=Object.assign({},R,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};

/* nosourcemap */